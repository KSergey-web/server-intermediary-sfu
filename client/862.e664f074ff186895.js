"use strict";(self.webpackChunkhardware_client=self.webpackChunkhardware_client||[]).push([[862],{6862:(ke,I,u)=>{u.r(I),u.d(I,{SubgroupModule:()=>f});var l=u(6895),r=u(433),U=u(5127),a=u(5643),V=u(8070),O=u(1446),d=u(7579),p=u(2722),e=u(4650),$=u(9646),N=u(9300),H=u(8372),Q=u(3900),Y=u(262),G=u(8746),m=u(3718),M=u(4111),B=u(9442),w=u(9088);function L(n,t){if(1&n&&(e.TgZ(0,"div",23)(1,"div",24),e._uU(2),e.ALo(3,"fio"),e.qZA(),e._uU(4),e.qZA()),2&n){const o=e.oxw().$implicit;e.xp6(2),e.Oqu(e.lcZ(3,2,o)),e.xp6(2),e.hij(" ",o.email," ")}}function R(n,t){if(1&n&&(e.TgZ(0,"li",21),e.YNc(1,L,5,4,"div",22),e.qZA()),2&n){const o=t.$implicit;e.xp6(1),e.Q6J("ngIf",o)}}function j(n,t){1&n&&(e.TgZ(0,"div",25),e._uU(1," \u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e "),e.qZA())}function K(n,t){1&n&&(e.TgZ(0,"div",25)(1,"div",26)(2,"span",27),e._uU(3,"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."),e.qZA()()())}const z=function(n){return{active:n}},P=function(n){return{disabled:n}};function X(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"li",28),e.NdJ("click",function(){const c=e.CHM(o).$implicit,h=e.oxw();return e.KtG(h.onClickUser(c))}),e.TgZ(1,"b"),e._uU(2),e.qZA(),e._UZ(3,"br"),e.TgZ(4,"small"),e._uU(5),e.qZA()()}if(2&n){const o=t.$implicit,s=e.oxw();e.Q6J("value",o)("ngClass",e.VKq(7,z,s.selectedUsers.includes(o)))("ngClass",e.VKq(9,P,s.isUserAlreadyInSubgroup(o))),e.xp6(2),e.lnq("",o.first_name," ",o.last_name," ",o.username,""),e.xp6(3),e.Oqu(o.email)}}class F{constructor(t,o,s,i){this.activeModal=t,this.modalService=o,this.ldapGroupStoreService=s,this.subgroupService=i,this.onDestroy$=new d.x,this.isLoading=!1,this.onAddUser=new e.vpe,this.groupName=new r.p4("",{validators:[r.kI.maxLength(40),r.kI.minLength(1)]}),this.foundUsers=[],this.selectedUsers=[]}set subgroup(t){this._subgroup=t,this._subgroup.users=t.users??[]}get subgroup(){return this._subgroup}ngOnDestroy(){this.onDestroy$.next(!0),this.onDestroy$.complete()}onDissmis(){this.activeModal.dismiss()}onClickUser(t){if(this.isUserAlreadyInSubgroup(t))return;const o=this.selectedUsers.findIndex(s=>s==t);-1!==o?this.selectedUsers.splice(o,1):this.selectedUsers.push(t)}clearTempate(){}subOnGroupNameChange(){this.groupName.valueChanges.pipe((0,N.h)(this.isNotEmptyString.bind(this)),(0,H.b)(1e3),(0,p.R)(this.onDestroy$),(0,Q.w)(t=>(this.isLoading=!0,this.selectedUsers=[],console.log(123),this.ldapGroupStoreService.getUsersByGroup(t).pipe((0,p.R)(this.onDestroy$),(0,Y.K)(o=>(console.error(o),(0,$.of)([]))),(0,G.x)(()=>{this.isLoading=!1}))))).subscribe({next:t=>{this.foundUsers=t},error:t=>{this.isLoading=!1,new m.p(this.modalService).addHeader("\u041e\u0448\u0438\u0431\u043a\u0430").addText(`\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u0421\u0442\u0430\u0442\u0443\u0441 ${t.status}. ${t.message}`).setDangerStyle().openAlertModal()}})}isUserAlreadyInSubgroup(t){return!!this.subgroup.users.find(o=>o.username===t.username)}ngOnInit(){this.subOnGroupNameChange()}isNotEmptyString(){return!!this.groupName.value.trim()}addUsersToSubgoup(){this.ldapGroupStoreService.addUsersToSubgroup(this._subgroup.id,this.selectedUsers).subscribe(t=>{new m.p(this.modalService).addHeader("\u041e\u0448\u0438\u0431\u043a\u0430").addText("\u0421\u043e\u0441\u0442\u0430\u0432 \u043f\u043e\u0434\u0433\u0440\u0443\u043f\u043f\u044b \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d").setInfoStyle().openAlertModal(),this.getSubgroup()},t=>console.log(t))}selectAll(){this.selectedUsers=this.foundUsers}getSubgroup(){this.subgroupService.getSubgroupById(this.subgroup.id).pipe((0,p.R)(this.onDestroy$)).subscribe(t=>this.subgroup=t)}}F.\u0275fac=function(t){return new(t||F)(e.Y36(a.Kz),e.Y36(a.FF),e.Y36(M.r),e.Y36(B.H))},F.\u0275cmp=e.Xpm({type:F,selectors:[["app-add-users"]],outputs:{onAddUser:"onAddUser"},features:[e._Bn([M.r])],decls:31,vars:8,consts:[[1,"container"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close","btn-close",3,"click"],["aria-hidden","true"],[1,"row"],[1,"col-6","users-block"],[1,"col-12","text-center"],[1,"alert","alert-info",3,"hidden"],[1,"col-12","pl-3","pr-3","list-group","list-group-numbered","overflow-auto","h-100"],["class","list-group-item d-flex justify-content-between align-items-start",4,"ngFor","ngForOf"],[1,"col-6","find-block"],[1,"form-group"],["for","fio"],["type","text","autocomplete","off","id","fio",3,"formControl"],[1,"list-group","col-10"],["class","text-center",4,"ngIf"],["class","list-group-item list-group-item-action",3,"value","ngClass","click",4,"ngFor","ngForOf"],[1,"pt-2","col","text-center"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","button",1,"ml-1","btn","btn-info",3,"disabled","click"],[1,"list-group-item","d-flex","justify-content-between","align-items-start"],["class","ms-2 me-auto",4,"ngIf"],[1,"ms-2","me-auto"],[1,"fw-bold"],[1,"text-center"],["role","status",1,"spinner-border"],[1,"sr-only"],[1,"list-group-item","list-group-item-action",3,"value","ngClass","click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),e._uU(3,"\u0418\u043c\u043f\u043e\u0440\u0442 \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432 \u0438\u0437 \u0431\u0430\u0437\u044b \u0421\u0424\u0423"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return o.onDissmis()}),e._UZ(5,"span",4),e.qZA()(),e.TgZ(6,"div",5)(7,"div",6)(8,"h6",7),e._uU(9,"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0441\u043e\u0441\u0442\u0430\u0432 \u043f\u043e\u0434\u0433\u0440\u0443\u043f\u043f\u044b"),e.qZA(),e.TgZ(10,"div",8),e._uU(11," \u0421\u043e\u0441\u0442\u0430\u0432 \u043f\u043e\u0434\u0433\u0440\u0443\u043f\u043f\u044b \u043f\u0443\u0441\u0442 "),e.qZA(),e.TgZ(12,"ol",9),e.YNc(13,R,2,1,"li",10),e.qZA()(),e.TgZ(14,"div",11)(15,"div",12)(16,"label",13),e._uU(17,"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u043e\u043b\u043d\u043e\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043d\u0430 \u0430\u043d\u0433\u043b\u0438\u0439\u0441\u043a\u043e\u043c \u044f\u0437\u044b\u043a\u0435"),e.qZA(),e._UZ(18,"br")(19,"input",14),e.qZA(),e.TgZ(20,"ul",15),e.YNc(21,j,2,0,"div",16),e.YNc(22,K,4,0,"div",16),e.YNc(23,X,6,11,"li",17),e.qZA(),e.TgZ(24,"div",18)(25,"button",19),e.NdJ("click",function(){return o.selectAll()}),e._uU(26," \u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435\u0445 "),e.qZA(),e._UZ(27,"br")(28,"hr"),e.TgZ(29,"button",20),e.NdJ("click",function(){return o.addUsersToSubgoup()}),e._uU(30," \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432 \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 "),e.qZA()()()()()),2&t&&(e.xp6(10),e.Q6J("hidden",0!==o.subgroup.users.length),e.xp6(3),e.Q6J("ngForOf",o.subgroup.users),e.xp6(6),e.Q6J("formControl",o.groupName),e.xp6(2),e.Q6J("ngIf",0===o.foundUsers.length&&!o.isLoading),e.xp6(1),e.Q6J("ngIf",o.isLoading),e.xp6(1),e.Q6J("ngForOf",o.foundUsers),e.xp6(2),e.Q6J("disabled",!o.foundUsers.length),e.xp6(4),e.Q6J("disabled",!o.selectedUsers.length))},dependencies:[r.Fj,r.JJ,r.oH,l.mk,l.sg,l.O5,w.o],styles:[".disabled[_ngcontent-%COMP%]{opacity:.5}"]});var W=u(8351);function ee(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"app-subgroup-form",6),e.NdJ("onDismiss",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.onDissmis())})("onSubmit",function(i){e.CHM(o);const c=e.oxw();return e.KtG(c.onSubmit(i))}),e.qZA()}if(2&n){const o=e.oxw();e.Q6J("initValuesForForm",o.initValuesForForm)}}class D{constructor(t,o,s){this.subgroupService=t,this.activeModal=o,this.modalService=s,this.onDestroy$=new d.x}ngOnInit(){this.InitSubgroupForm()}ngOnDestroy(){this.onDestroy$.next(!0),this.onDestroy$.complete()}InitSubgroupForm(){this.initValuesForForm={...this.subgroup},this.initValuesForForm.acceptButtonText="\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f",this.initValuesForForm.users=[...this.subgroup.users]}onDissmis(){this.activeModal.dismiss()}SomeError(t){console.error(t),new m.p(this.modalService).addHeader("\u041e\u0448\u0438\u0431\u043a\u0430").addText("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a").setDangerStyle().openAlertModal()}onSubmit(t){this.subgroupService.updateSubgroup(t,this.subgroup.id).pipe((0,p.R)(this.onDestroy$)).subscribe({next:()=>this.activeModal.close(),error:o=>{console.log(o),new m.p(this.modalService).addHeader("\u041e\u0448\u0438\u0431\u043a\u0430").addText(`\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u0434\u0433\u0440\u0443\u043f\u043f\u0443. \u0421\u0442\u0430\u0442\u0443\u0441 ${o.status}. ${o.message}`).setDangerStyle().openAlertModal()}})}}D.\u0275fac=function(t){return new(t||D)(e.Y36(B.H),e.Y36(a.Kz),e.Y36(a.FF))},D.\u0275cmp=e.Xpm({type:D,selectors:[["app-edit-subgroup"]],inputs:{subgroup:"subgroup"},decls:7,vars:1,consts:[[1,"container"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close","btn-close",3,"click"],["aria-hidden","true"],[3,"initValuesForForm","onDismiss","onSubmit",4,"ngIf"],[3,"initValuesForForm","onDismiss","onSubmit"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),e._uU(3,"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u043e\u0434\u0433\u0440\u0443\u043f\u043f\u044b"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return o.onDissmis()}),e._UZ(5,"span",4),e.qZA()(),e.YNc(6,ee,1,1,"app-subgroup-form",5),e.qZA()),2&t&&(e.xp6(6),e.Q6J("ngIf",o.initValuesForForm))},dependencies:[W.W,l.O5]});var te=u(4004),oe=u(2389),ne=u(4364),se=u(529);class g{constructor(t,o){this.apiUrl=t,this.http=o}getBookingsOfSubgoup(t){return this.http.get(`${this.apiUrl}/api/bookings/by-subgroup/${t.id}`).pipe((0,te.U)(o=>this.strDatesToObjectDatesForBookings(o.bookings)))}createBooking(t){return this.http.post(`${this.apiUrl}/api/bookings?`+oe.c.serialize,{data:t})}updateBooking(t,o){const s={data:t};return delete s.data.id,this.http.put(`${this.apiUrl}/api/bookings/${o}`,s)}strDatesToObjectDatesForBooking(t){return t.begin=new Date(t.begin),t.end=new Date(t.end),t}strDatesToObjectDatesForBookings(t){return t.map(o=>this.strDatesToObjectDatesForBooking(o))}}g.\u0275fac=function(t){return new(t||g)(e.LFG(ne.T5),e.LFG(se.eN))},g.\u0275prov=e.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"});var ie=u(6798);function ue(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"span",3),e.NdJ("mouseenter",function(){const c=e.CHM(o).$implicit,h=e.oxw();return e.KtG(h.hoveredDate=c)})("mouseleave",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.hoveredDate=null)}),e._uU(1),e.qZA()}if(2&n){const o=t.$implicit,s=t.focused,i=e.oxw();e.ekj("focused",s)("range",i.isRange(o))("faded",i.isHovered(o)||i.isInside(o)),e.xp6(1),e.hij(" ",o.day," ")}}class v{constructor(t){this.calendar=t,this.beginChange=new e.vpe,this.endChange=new e.vpe,this.hoveredDate=null}get fromDate(){return this._fromDate}set fromDate(t){this._fromDate=t,this.changeBeginDate()}get toDate(){return this._toDate}set toDate(t){this._toDate=t,this.changeEndDate()}ngOnInit(){setTimeout(this.initFromDateAndToDate.bind(this))}initFromDateAndToDate(){this.begin&&this.end?(this.fromDate=new a.qj(this.begin.getFullYear(),this.begin.getMonth()+1,this.begin.getDate()),this.toDate=new a.qj(this.end.getFullYear(),this.end.getMonth()+1,this.end.getDate())):(this.fromDate=this.calendar.getToday(),this.toDate=null)}changeBeginDate(){this.begin=new Date(this.fromDate.year,this.fromDate.month-1,this.fromDate.day),this.beginChange.emit(this.begin)}changeEndDate(){this.end=this.toDate?new Date(this.toDate.year,this.toDate.month-1,this.toDate.day):this.begin,this.end?.setHours(23),this.end?.setMinutes(59),this.end?.setSeconds(59),this.endChange.emit(this.end)}onDateSelection(t){this.fromDate||this.toDate?this.fromDate&&!this.toDate&&t.after(this.fromDate)?this.toDate=t:(this.toDate=null,this.fromDate=t):this.fromDate=t}isHovered(t){return this.fromDate&&!this.toDate&&this.hoveredDate&&t.after(this.fromDate)&&t.before(this.hoveredDate)}isInside(t){return this.toDate&&t.after(this.fromDate)&&t.before(this.toDate)}isRange(t){return t.equals(this.fromDate)||this.toDate&&t.equals(this.toDate)||this.isInside(t)||this.isHovered(t)}}function re(n,t){if(1&n&&(e.TgZ(0,"option",12),e._uU(1),e.qZA()),2&n){const o=t.$implicit;e.Q6J("value",o.id),e.xp6(1),e.hij(" ",o.name," ")}}v.\u0275fac=function(t){return new(t||v)(e.Y36(a.vL))},v.\u0275cmp=e.Xpm({type:v,selectors:[["app-range-date-picker"]],inputs:{begin:"begin",end:"end"},outputs:{beginChange:"beginChange",endChange:"endChange"},decls:5,vars:2,consts:[["outsideDays","hidden",3,"displayMonths","dayTemplate","dateSelect"],["dp",""],["t",""],[1,"custom-day",3,"mouseenter","mouseleave"]],template:function(t,o){if(1&t&&(e.TgZ(0,"ngb-datepicker",0,1),e.NdJ("dateSelect",function(i){return o.onDateSelection(i)}),e.qZA(),e.YNc(2,ue,2,7,"ng-template",null,2,e.W1O),e._UZ(4,"hr")),2&t){const s=e.MAs(3);e.Q6J("displayMonths",2)("dayTemplate",s)}},dependencies:[a.VL],styles:[".custom-day[_ngcontent-%COMP%]{text-align:center;padding:.185rem .25rem;display:inline-block;height:2rem;width:2rem}.custom-day.focused[_ngcontent-%COMP%]{background-color:#e6e6e6}.custom-day.range[_ngcontent-%COMP%], .custom-day[_ngcontent-%COMP%]:hover{background-color:#0275d8;color:#fff}.custom-day.faded[_ngcontent-%COMP%]{background-color:#0275d880}"]});class b{constructor(t,o){this.formBuilder=t,this.equipmentService=o,this.acceptButtonText="\u041e\u043a",this.equipments=[],this.onDestroy$=new d.x,this.onSubmit=new e.vpe,this.onDismiss=new e.vpe,this.initForm()}getEquipments(){this.equipmentService.getEquipments().pipe((0,p.R)(this.onDestroy$)).subscribe(t=>{this.equipments=t})}ngOnDestroy(){this.onDestroy$.next(!0),this.onDestroy$.complete()}closeModal(){this.onDismiss.emit(!0)}ngOnInit(){this.setInitValuesToForm(),this.getEquipments()}initForm(){this.bookingForm=this.formBuilder.group({session_duration:[30,[r.kI.required,r.kI.min(30),r.kI.max(240)]],max_sessions_count_per_day:[1,[r.kI.required,r.kI.min(1),r.kI.max(30)]],equipment:[null,r.kI.required]})}isBookingInvalid(){return this.bookingForm.invalid}getDataFromForm(){return{begin:this.begin,end:this.end,subgroup:this.subgroupId,equipment:this.bookingForm.controls.equipment.value,session_duration:this.bookingForm.controls.session_duration.value,max_sessions_count_per_day:this.bookingForm.controls.max_sessions_count_per_day.value}}setInitValuesToForm(){this.bookingForm.controls.max_sessions_count_per_day.setValue(this.initValuesForForm.max_sessions_count_per_day),this.bookingForm.controls.session_duration.setValue(this.initValuesForForm.session_duration),this.initValuesForForm.equipmentId&&this.bookingForm.controls.equipment.setValue(this.initValuesForForm.equipmentId),this.acceptButtonText=this.initValuesForForm.acceptButtonText??"",this.begin=this.initValuesForForm.begin,this.end=this.initValuesForForm.end}submit(){const t=this.getDataFromForm();this.onSubmit.emit(t)}}function ae(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"app-booking-form",6),e.NdJ("onDismiss",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.onDissmis())})("onSubmit",function(i){e.CHM(o);const c=e.oxw();return e.KtG(c.onSubmit(i))}),e.qZA()}if(2&n){const o=e.oxw();e.Q6J("initValuesForForm",o.initValuesForForm)}}b.\u0275fac=function(t){return new(t||b)(e.Y36(r.QS),e.Y36(ie.Q))},b.\u0275cmp=e.Xpm({type:b,selectors:[["app-booking-form"]],inputs:{subgroupId:"subgroupId",initValuesForForm:"initValuesForForm"},outputs:{onSubmit:"onSubmit",onDismiss:"onDismiss"},decls:18,vars:6,consts:[["novalidate","",1,"col",3,"formGroup","ngSubmit"],[3,"begin","end","beginChange","endChange"],[1,"form-group","col-6"],["for","equipment"],["id","equipment","name","equipment","formControlName","equipment",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["for","session_duration"],["type","number","id","session_duration","name","session_duration","formControlName","session_duration",1,"form-control"],["for","max_sessions_count_per_day"],["type","number","id","max_sessions_count_per_day","name","max_sessions_count_per_day","formControlName","max_sessions_count_per_day",1,"form-control"],[1,"text-center","mt-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],[3,"value"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.submit()}),e.TgZ(1,"app-range-date-picker",1),e.NdJ("beginChange",function(i){return o.begin=i})("endChange",function(i){return o.end=i}),e.qZA(),e.TgZ(2,"div",2)(3,"label",3),e._uU(4,"\u041e\u0431\u043e\u0440\u0443\u0434\u043e\u0432\u0430\u043d\u0438\u0435"),e.qZA(),e.TgZ(5,"select",4),e.YNc(6,re,2,2,"option",5),e.qZA()(),e.TgZ(7,"div",2)(8,"label",6),e._uU(9,"\u0414\u043b\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u0438"),e.qZA(),e._UZ(10,"input",7),e.qZA(),e.TgZ(11,"div",2)(12,"label",8),e._uU(13,"\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0435\u0441\u0441\u0438\u0439 \u0432 \u0434\u0435\u043d\u044c"),e.qZA(),e._UZ(14,"input",9),e.qZA(),e.TgZ(15,"div",10)(16,"button",11),e._uU(17),e.qZA()()()),2&t&&(e.Q6J("formGroup",o.bookingForm),e.xp6(1),e.Q6J("begin",o.begin)("end",o.end),e.xp6(5),e.Q6J("ngForOf",o.equipments),e.xp6(10),e.Q6J("disabled",o.isBookingInvalid()),e.xp6(1),e.hij(" ",o.acceptButtonText," "))},dependencies:[r._Y,r.YN,r.Kr,r.Fj,r.wV,r.EJ,r.JJ,r.JL,r.sg,r.u,l.sg,v]});class y{constructor(t,o,s){this.bookingService=t,this.activeModal=o,this.modalService=s,this.onDestroy$=new d.x}ngOnInit(){this.InitBookingForm()}ngOnDestroy(){this.onDestroy$.next(!0),this.onDestroy$.complete()}onDissmis(){this.activeModal.dismiss()}InitBookingForm(){this.initValuesForForm={},this.initValuesForForm.acceptButtonText="\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",this.initValuesForForm.begin=this.booking.begin,this.initValuesForForm.end=this.booking.end,this.initValuesForForm.equipmentId=this.booking.equipment?.id,this.initValuesForForm.max_sessions_count_per_day=this.booking.max_sessions_count_per_day,this.initValuesForForm.session_duration=this.booking.session_duration}SomeError(t){console.error(t),new m.p(this.modalService).addHeader("\u041e\u0448\u0438\u0431\u043a\u0430").addText("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a").setDangerStyle().openAlertModal()}onSubmit(t){this.bookingService.updateBooking(t,this.booking.id).pipe((0,p.R)(this.onDestroy$)).subscribe({next:o=>this.activeModal.close(o),error:o=>{console.error(o),new m.p(this.modalService).addHeader("\u041e\u0448\u0438\u0431\u043a\u0430").addText(`\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0431\u0440\u043e\u043d\u044c. \u0421\u0442\u0430\u0442\u0443\u0441 ${o.status}. ${o.message}`).setDangerStyle().openAlertModal()}})}}function le(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"app-booking-form",6),e.NdJ("onDismiss",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.onDissmis())})("onSubmit",function(i){e.CHM(o);const c=e.oxw();return e.KtG(c.onSubmit(i))}),e.qZA()}if(2&n){const o=e.oxw();e.Q6J("initValuesForForm",o.initValuesForForm)}}y.\u0275fac=function(t){return new(t||y)(e.Y36(g),e.Y36(a.Kz),e.Y36(a.FF))},y.\u0275cmp=e.Xpm({type:y,selectors:[["app-edit-booking"]],inputs:{subgroup:"subgroup",booking:"booking"},decls:7,vars:1,consts:[[1,"container"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close","btn-close",3,"click"],["aria-hidden","true"],[3,"initValuesForForm","onDismiss","onSubmit",4,"ngIf"],[3,"initValuesForForm","onDismiss","onSubmit"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),e._uU(3,"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0431\u0440\u043e\u043d\u0438"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return o.onDissmis()}),e._UZ(5,"span",4),e.qZA()(),e.YNc(6,ae,1,1,"app-booking-form",5),e.qZA()),2&t&&(e.xp6(6),e.Q6J("ngIf",o.initValuesForForm))},dependencies:[l.O5,b]});class x{constructor(t,o,s){this.bookingService=t,this.activeModal=o,this.modalService=s,this.onDestroy$=new d.x,this.InitBookingForm()}ngOnDestroy(){this.onDestroy$.next(!0),this.onDestroy$.complete()}onDissmis(){this.activeModal.dismiss()}InitBookingForm(){this.initValuesForForm={},this.initValuesForForm.acceptButtonText="\u0421\u043e\u0437\u0434\u0430\u0442\u044c"}SomeError(t){console.error(t),new m.p(this.modalService).addHeader("\u041e\u0448\u0438\u0431\u043a\u0430").addText("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a").setDangerStyle().openAlertModal()}onSubmit(t){t.subgroup=this.subgroup.id,this.bookingService.createBooking(t).pipe((0,p.R)(this.onDestroy$)).subscribe({next:o=>this.activeModal.close(o),error:o=>{console.error(o),new m.p(this.modalService).addHeader("\u041e\u0448\u0438\u0431\u043a\u0430").addText(`\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0431\u0440\u043e\u043d\u044c. \u0421\u0442\u0430\u0442\u0443\u0441 ${o.status}. ${o.message}`).setDangerStyle().openAlertModal()}})}}x.\u0275fac=function(t){return new(t||x)(e.Y36(g),e.Y36(a.Kz),e.Y36(a.FF))},x.\u0275cmp=e.Xpm({type:x,selectors:[["app-create-booking"]],inputs:{subgroup:"subgroup"},decls:7,vars:1,consts:[[1,"container"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close","btn-close",3,"click"],["aria-hidden","true"],[3,"initValuesForForm","onDismiss","onSubmit",4,"ngIf"],[3,"initValuesForForm","onDismiss","onSubmit"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),e._uU(3,"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0431\u0440\u043e\u043d\u0438"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return o.onDissmis()}),e._UZ(5,"span",4),e.qZA()(),e.YNc(6,le,1,1,"app-booking-form",5),e.qZA()),2&t&&(e.xp6(6),e.Q6J("ngIf",o.initValuesForForm))},dependencies:[l.O5,b]});var q=u(7252),ce=u(2276),pe=u(1135),E=u(5698);function me(n,t){if(1&n&&(e.TgZ(0,"tr")(1,"th",4),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"date"),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"date"),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA()()),2&n){const o=t.$implicit,s=t.index;e.xp6(2),e.Oqu(s),e.xp6(2),e.Oqu(e.xi3(5,9,o.begin,"dd.MM.YYYY HH:mm")),e.xp6(3),e.hij(" ",e.xi3(8,12,o.end,"dd.MM.YYYY HH:mm"),""),e.xp6(3),e.lnq(" ",null==o.user?null:o.user.first_name," ",null==o.user?null:o.user.last_name," ",null==o.user?null:o.user.patronymic,""),e.xp6(2),e.lnq(" ",null==o.creator?null:o.creator.first_name," ",null==o.creator?null:o.creator.last_name," ",null==o.creator?null:o.creator.patronymic,"")}}class S{constructor(t,o){this.cb=t,this.sessionService=o,this.sessions=[]}ngOnChanges(t){const o=t.selectedDate.currentValue;o&&this.getSessionsInDateByEquipment(o)}ngOnInit(){}getSessionsInDateByEquipment(t){this.sessionService.getSessionsInDateByEquipment(this.equipment,t).pipe((0,E.q)(1)).subscribe(this.gottedSessions.bind(this))}gottedSessions(t){this.sessions=t,this.cb.detectChanges()}}function de(n,t){if(1&n&&(e.TgZ(0,"div",9)(1,"label",16),e._uU(2,"\u041e\u0431\u043e\u0440\u0443\u0434\u043e\u0432\u0430\u043d\u0438\u0435"),e.qZA(),e.TgZ(3,"select",17)(4,"option",18),e._uU(5),e.qZA()()()),2&n){const o=e.oxw(2);e.xp6(5),e.hij(" ",o.initValuesForForm.equipment.name," ")}}function ge(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"ngb-datepicker",19),e.NdJ("dateSelect",function(i){e.CHM(o);const c=e.oxw(2);return e.KtG(c.onSelectDate(i))}),e.qZA()}if(2&n){const o=e.oxw(2);e.Q6J("startDate",o.todayNgb)("minDate",o.todayNgb)("maxDate",o.maxDateNgb)}}function he(n,t){if(1&n&&(e.TgZ(0,"div",9)(1,"p",7),e._uU(2," \u041e\u0441\u0442\u0430\u0432\u0448\u0435\u0435\u0441\u044f \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0435\u0430\u043d\u0441\u043e\u0432 \u0432 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0439 \u0434\u0435\u043d\u044c "),e.TgZ(3,"b"),e._uU(4),e.ALo(5,"async"),e.qZA()()()),2&n){const o=e.oxw(2);e.xp6(4),e.Oqu(e.lcZ(5,1,o.remainingCount$))}}function be(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"form",2),e.NdJ("ngSubmit",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.submit())}),e.TgZ(1,"div",3),e.YNc(2,de,6,1,"div",4),e.YNc(3,ge,1,3,"ngb-datepicker",5),e.YNc(4,he,6,3,"div",4),e.TgZ(5,"div",6)(6,"label",7),e._uU(7,"\u0412\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u0430 \u0441\u0435\u0430\u043d\u0441\u0430"),e.qZA(),e._UZ(8,"ngb-timepicker",8),e.qZA(),e.TgZ(9,"p"),e._uU(10," \u041a\u043e\u043d\u0435\u0446 \u0441\u0435\u0430\u043d\u0441\u0430 \u0432 "),e.TgZ(11,"b"),e._uU(12),e.ALo(13,"date"),e.qZA()(),e.TgZ(14,"div",9)(15,"label",10),e._uU(16,"\u0414\u043b\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u0438"),e.qZA(),e._UZ(17,"input",11),e.qZA(),e.TgZ(18,"div",9)(19,"label",12),e._uU(20,"\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0435\u0441\u0441\u0438\u0439 \u0432 \u0434\u0435\u043d\u044c"),e.qZA(),e._UZ(21,"input",13),e.qZA()(),e.TgZ(22,"div",14)(23,"button",15),e._uU(24),e.qZA()()()}if(2&n){const o=e.oxw();e.Q6J("formGroup",o.sessionForm),e.xp6(2),e.Q6J("ngIf",o.initValuesForForm.equipment),e.xp6(1),e.Q6J("ngIf",o.maxDateNgb),e.xp6(1),e.Q6J("ngIf",o.selectedDate),e.xp6(8),e.Oqu(e.xi3(13,9,o.session_end,"HH:mm")),e.xp6(5),e.Q6J("value",o.initValuesForForm.session_duration),e.xp6(4),e.Q6J("value",o.initValuesForForm.max_session_duration_per_day),e.xp6(2),e.Q6J("disabled",!o.getBeginAndEndFromForm()||o.remainingCount$.getValue()<=0),e.xp6(1),e.hij(" ",o.acceptButtonText," ")}}function _e(n,t){if(1&n&&e._UZ(0,"app-sessions-in-date",20),2&n){const o=e.oxw();e.Q6J("selectedDate",o.selectedDate)("equipment",o.initValuesForForm.equipment)}}S.\u0275fac=function(t){return new(t||S)(e.Y36(e.sBO),e.Y36(q.m))},S.\u0275cmp=e.Xpm({type:S,selectors:[["app-sessions-in-date"]],inputs:{selectedDate:"selectedDate",equipment:"equipment"},features:[e.TTD],decls:19,vars:5,consts:[[1,"table"],[2,"caption-side","top"],["scope","col"],[4,"ngFor","ngForOf"],["scope","row"]],template:function(t,o){1&t&&(e.TgZ(0,"table",0)(1,"caption",1)(2,"b"),e._uU(3),e.ALo(4,"date"),e.qZA()(),e.TgZ(5,"thead")(6,"tr")(7,"th",2),e._uU(8,"#"),e.qZA(),e.TgZ(9,"th",2),e._uU(10,"\u041d\u0430\u0447\u0430\u043b\u043e"),e.qZA(),e.TgZ(11,"th",2),e._uU(12,"\u041a\u043e\u043d\u0435\u0446"),e.qZA(),e.TgZ(13,"th",2),e._uU(14,"\u041a\u043e\u043c\u0443 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u043e"),e.qZA(),e.TgZ(15,"th",2),e._uU(16,"\u041a\u0442\u043e \u0441\u043e\u0437\u0434\u0430\u043b"),e.qZA()()(),e.TgZ(17,"tbody"),e.YNc(18,me,13,15,"tr",3),e.qZA()()),2&t&&(e.xp6(3),e.hij("\u0417\u0430\u0431\u0440\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0441\u0435\u0430\u043d\u0441\u044b \u043d\u0430 ",e.xi3(4,2,o.selectedDate,"dd.MM.YYYY"),""),e.xp6(15),e.Q6J("ngForOf",o.sessions))},dependencies:[l.sg,l.uU],changeDetection:0});class C{constructor(t,o,s,i){this.formBuilder=t,this.calendar=o,this.cb=s,this.sessionService=i,this.acceptButtonText="\u041e\u043a",this.todayNgb=this.calendar.getToday(),this.onDestroy$=new d.x,this.onSubmit=new e.vpe,this.remainingCount$=new pe.X(0),this.initForm()}setMaxDate(t){this.maxDateNgb=new a.qj(t.getFullYear(),t.getMonth()+1,t.getDate())}ngOnDestroy(){this.onDestroy$.next(!0),this.onDestroy$.complete()}ngOnInit(){this.setInitValuesToForm(),this.subOnChangesTime()}initForm(){this.sessionForm=this.formBuilder.group({time:[]})}subOnChangesTime(){this.sessionForm.controls.time.valueChanges.subscribe(t=>{this.updateSessionDates()})}updateSessionDates(){const t=this.sessionForm.controls.time.value;if(!this.selectedDate||!t)return;const{hour:o,minute:s}=t;this.session_begin=new Date(this.selectedDate),this.session_begin.setHours(o),this.session_begin.setMinutes(s),this.session_end=new Date(+this.session_begin+1e3*this.session_duration*60)}onSelectDate(t){this.selectedDate=new Date(t.year,t.month-1,t.day),this.updateSessionDates(),this.getRemainingSessionsCountInDay(),this.cb.detectChanges()}getRemainingSessionsCountInDay(){this.sessionService.getRemainingSessionsInDate(this.selectedDate.toJSON(),this.bookingId).pipe((0,E.q)(1)).subscribe(({count:t})=>{this.remainingCount$.next(t)})}getBeginAndEndFromForm(){return this.selectedDate&&this.session_end?{begin:this.session_begin}:null}setInitValuesToForm(){this.acceptButtonText=this.initValuesForForm.acceptButtonText??"",this.session_duration=this.initValuesForForm.session_duration,this.bookingId=this.initValuesForForm.bookingId,this.setMaxDate(this.initValuesForForm.booking_end)}submit(){const t=this.getBeginAndEndFromForm();this.onSubmit.emit(t)}}function fe(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"app-session-form-by-booking",6),e.NdJ("onDismiss",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.onDissmis())})("onSubmit",function(i){e.CHM(o);const c=e.oxw();return e.KtG(c.onSubmit(i))}),e.qZA()}if(2&n){const o=e.oxw();e.Q6J("initValuesForForm",o.initValuesForForm)}}C.\u0275fac=function(t){return new(t||C)(e.Y36(r.QS),e.Y36(a.vL),e.Y36(e.sBO),e.Y36(q.m))},C.\u0275cmp=e.Xpm({type:C,selectors:[["app-session-form-by-booking"]],inputs:{initValuesForForm:"initValuesForForm"},outputs:{onSubmit:"onSubmit"},decls:2,vars:2,consts:[["class","col","novalidate","",3,"formGroup","ngSubmit",4,"ngIf"],[3,"selectedDate","equipment",4,"ngIf"],["novalidate","",1,"col",3,"formGroup","ngSubmit"],[1,"col-6"],["class","form-group",4,"ngIf"],["outsideDays","hidden",3,"startDate","minDate","maxDate","dateSelect",4,"ngIf"],[1,"form-group","mt-2"],["for","time"],["id","time","name","time","formControlName","time"],[1,"form-group"],["for","session_duration"],["disabled","","type","number","id","session_duration","name","session_duration",1,"form-control",3,"value"],["for","max_session_duration_per_day"],["disabled","","type","number","id","max_session_duration_per_day","name","max_session_duration_per_day",1,"form-control",3,"value"],[1,"text-center","mt-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["for","equipment"],["disabled","","id","equipment","name","equipment",1,"form-select"],["selected",""],["outsideDays","hidden",3,"startDate","minDate","maxDate","dateSelect"],[3,"selectedDate","equipment"]],template:function(t,o){1&t&&(e.YNc(0,be,25,12,"form",0),e.YNc(1,_e,1,2,"app-sessions-in-date",1)),2&t&&(e.Q6J("ngIf",o.initValuesForForm),e.xp6(1),e.Q6J("ngIf",o.initValuesForForm))},dependencies:[r._Y,r.YN,r.Kr,r.JJ,r.JL,r.sg,r.u,l.O5,a.VL,a.Pm,S,l.Ov,l.uU]});class Z{constructor(t,o,s,i){this.sessionService=t,this.activeModal=o,this.modalService=s,this.dateFormatter=i,this.onDestroy$=new d.x}ngOnInit(){this.InitSessionForm()}ngOnDestroy(){this.onDestroy$.next(!0),this.onDestroy$.complete()}onDissmis(){this.activeModal.dismiss()}InitSessionForm(){this.initValuesForForm={bookingId:this.booking.id},this.initValuesForForm.acceptButtonText="\u0421\u043e\u0437\u0434\u0430\u0442\u044c",this.initValuesForForm.equipment=this.booking.equipment,this.initValuesForForm.booking_begin=this.booking.begin,this.initValuesForForm.booking_end=this.booking.end,this.initValuesForForm.session_duration=this.booking.session_duration,this.initValuesForForm.max_session_duration_per_day=this.booking.max_sessions_count_per_day}SomeError(t){console.error(t),new m.p(this.modalService).addHeader("\u041e\u0448\u0438\u0431\u043a\u0430").addText("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a").setDangerStyle().openAlertModal()}onSubmit(t){let o={...t,booking:this.booking.id};this.sessionService.signupForSession(o).pipe((0,p.R)(this.onDestroy$)).subscribe({next:s=>this.activeModal.close(s),error:s=>{console.error(s),400!==s.status?this.showDefaultError(s):this.createBusyErrorAlert(s)}})}showDefaultError(t){new m.p(this.modalService).addHeader("\u041e\u0448\u0438\u0431\u043a\u0430").addText("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0431\u0440\u043e\u043d\u044c.").setDangerStyle().openAlertModal()}createBusyErrorAlert(t){const{begin:o,end:s}=t.error.error.details.busy;new m.p(this.modalService).addHeader("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e").addText(`\u0423\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u0435\u0441\u0441\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u0432 ${this.dateFormatter.getFormattedDateTime(o)} \u0438 \u0437\u0430\u043a\u0430\u043d\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0432 ${this.dateFormatter.getFormattedDateTime(s)}`).setDangerStyle().openAlertModal()}}function Fe(n,t){1&n&&(e.TgZ(0,"tr",8)(1,"td",9),e._uU(2," \u041d\u0435\u0442 \u0430\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0445 \u0431\u0440\u043e\u043d\u0435\u0439"),e.qZA()())}function De(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"tr")(1,"th",10),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.ALo(7,"date"),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.ALo(10,"date"),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td",11)(16,"button",12),e.NdJ("click",function(){const c=e.CHM(o).$implicit,h=e.oxw();return e.KtG(h.editBooking(c))}),e._uU(17," \u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"),e.qZA()(),e.TgZ(18,"td",11)(19,"button",13),e.NdJ("click",function(){const c=e.CHM(o).$implicit,h=e.oxw();return e.KtG(h.createSessionByBooking(c))}),e._uU(20," \u0417\u0430\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f \u043d\u0430 \u0441\u0435\u0441\u0441\u0438\u044e"),e.qZA()()()}if(2&n){const o=t.$implicit,s=t.index;e.xp6(2),e.Oqu(s+1),e.xp6(2),e.hij(" ",null==o.equipment?null:o.equipment.name,""),e.xp6(2),e.hij(" ",e.xi3(7,6,o.begin,"dd.MM.YYYY HH:mm"),""),e.xp6(3),e.hij(" ",e.xi3(10,9,o.end,"dd.MM.YYYY HH:mm"),""),e.xp6(3),e.hij(" ",o.session_duration,""),e.xp6(2),e.hij(" ",o.max_sessions_count_per_day,"")}}Z.\u0275fac=function(t){return new(t||Z)(e.Y36(q.m),e.Y36(a.Kz),e.Y36(a.FF),e.Y36(ce.C))},Z.\u0275cmp=e.Xpm({type:Z,selectors:[["app-create-session-by-booking"]],inputs:{booking:"booking"},decls:7,vars:1,consts:[[1,"container"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close","btn-close",3,"click"],["aria-hidden","true"],[3,"initValuesForForm","onDismiss","onSubmit",4,"ngIf"],[3,"initValuesForForm","onDismiss","onSubmit"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),e._uU(3,"\u0417\u0430\u043f\u0438\u0441\u044c \u043d\u0430 \u0441\u0435\u0441\u0441\u0438\u044e"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return o.onDissmis()}),e._UZ(5,"span",4),e.qZA()(),e.YNc(6,fe,1,1,"app-session-form-by-booking",5),e.qZA()),2&t&&(e.xp6(6),e.Q6J("ngIf",o.initValuesForForm))},dependencies:[l.O5,C]});class T{constructor(t,o){this.modalService=t,this.bookingService=o,this.bookings=[],this.onDestroy$=new d.x}ngOnDestroy(){this.onDestroy$.next(!0),this.onDestroy$.complete()}subOnUpdate(){this.update$.subscribe(()=>{this.getBookings()})}ngOnInit(){this.getBookings()}editBooking(t){const o=this.modalService.open(y,{size:"lg"});o.componentInstance.booking=t,o.componentInstance.subgroup=this.subgroup,this.performResultModal(o)}createSessionByBooking(t){const o=this.modalService.open(Z,{size:"lg"});o.componentInstance.booking=t,this.performResultModal(o)}performResultModal(t){t.result.then(()=>{this.getBookings()})}getBookings(){this.bookingService.getBookingsOfSubgoup(this.subgroup).pipe((0,p.R)(this.onDestroy$)).subscribe(t=>{this.bookings=t})}createBooking(){const t=this.modalService.open(x,{size:"lg"});t.componentInstance.subgroup=this.subgroup,this.performResultModal(t)}}T.\u0275fac=function(t){return new(t||T)(e.Y36(a.FF),e.Y36(g))},T.\u0275cmp=e.Xpm({type:T,selectors:[["app-list-bookings"]],inputs:{subgroup:"subgroup",update$:"update$"},decls:26,vars:2,consts:[[1,"pt-3"],["data-access-only","teacher",1,"btn","btn-primary",3,"click"],[1,"table-responsive"],[1,"table"],["scope","col"],[1,"highlight_tr_hover"],["class","alert alert-info",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"alert","alert-info"],["colspan","6",1,"text-center"],["scope","row"],["colspan","1"],["data-access-only","teacher",1,"btn","btn-secondary",3,"click"],["data-access-only","authenticated",1,"btn","btn-secondary",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return o.createBooking()}),e._uU(2,"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0431\u0440\u043e\u043d\u044c"),e.qZA()(),e.TgZ(3,"div",2)(4,"table",3)(5,"caption")(6,"b"),e._uU(7,"\u0421\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0435 \u0431\u0440\u043e\u043d\u0438"),e.qZA()(),e.TgZ(8,"thead")(9,"tr")(10,"th",4),e._uU(11,"#"),e.qZA(),e.TgZ(12,"th",4),e._uU(13,"\u041e\u0431\u043e\u0440\u0443\u0434\u043e\u0432\u0430\u043d\u0438\u0435"),e.qZA(),e.TgZ(14,"th",4),e._uU(15,"\u0441"),e.qZA(),e.TgZ(16,"th",4),e._uU(17,"\u0434\u043e"),e.qZA(),e.TgZ(18,"th",4),e._uU(19,"\u0414\u043b\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0441\u0435\u0430\u043d\u0441\u0430 (\u043c\u0438\u043d)"),e.qZA(),e.TgZ(20,"th",4),e._uU(21,"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0435\u0430\u043d\u0441\u043e\u0432 \u0432 \u0434\u0435\u043d\u044c"),e.qZA(),e._UZ(22,"th"),e.qZA()(),e.TgZ(23,"tbody",5),e.YNc(24,Fe,3,0,"tr",6),e.YNc(25,De,21,12,"tr",7),e.qZA()()()),2&t&&(e.xp6(24),e.Q6J("ngIf",0===o.bookings.length),e.xp6(1),e.Q6J("ngForOf",o.bookings))},dependencies:[l.sg,l.O5,l.uU]});var J=u(7556);class k{constructor(t,o,s){this.ref=t,this.render=o,this.authService=s}ngDoCheck(){this.hideForbbidenElements(this.authService.currentUser.role)}hideForbbidenElements(t){this.ref.nativeElement.querySelectorAll("[data-access-only]").forEach(s=>{s.getAttribute("data-access-only")!==t&&this.render.addClass(s,"d-none")})}}function ve(n,t){if(1&n&&(e.TgZ(0,"div",16)(1,"div",17),e._uU(2),e.ALo(3,"fio"),e.qZA(),e._uU(4),e.qZA()),2&n){const o=e.oxw().$implicit;e.xp6(2),e.Oqu(e.lcZ(3,2,o)),e.xp6(2),e.hij(" ",o.email," ")}}function ye(n,t){if(1&n&&(e.TgZ(0,"li",14),e.YNc(1,ve,5,4,"div",15),e.qZA()),2&n){const o=t.$implicit;e.xp6(1),e.Q6J("ngIf",o)}}function xe(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"div",4)(1,"div",2)(2,"h2",5),e._uU(3,"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u0433\u0440\u0443\u043f\u043f\u044b"),e.qZA()(),e.TgZ(4,"div",6)(5,"div",7)(6,"p"),e._uU(7),e._UZ(8,"br"),e._uU(9),e.ALo(10,"fio"),e._UZ(11,"br"),e._uU(12),e._UZ(13,"br"),e.qZA(),e.TgZ(14,"div",8)(15,"button",9),e.NdJ("click",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.editSubgroup())}),e._uU(16," \u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"),e.qZA(),e.TgZ(17,"button",9),e.NdJ("click",function(){e.CHM(o);const i=e.oxw();return e.KtG(i.addUsersByGroupName())}),e._uU(18,"\u0418\u043c\u043f\u043e\u0440\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043f\u043e \u0433\u0440\u0443\u043f\u043f\u0435 \u0438\u0437 \u0431\u0430\u0437\u044b \u0421\u0424\u0423"),e.qZA()()(),e.TgZ(19,"div",10)(20,"h6",5),e._uU(21,"\u0421\u043e\u0441\u0442\u0430\u0432 \u043f\u043e\u0434\u0433\u0440\u0443\u043f\u043f\u044b"),e.qZA(),e.TgZ(22,"div",11),e._uU(23," \u0421\u043e\u0441\u0442\u0430\u0432 \u043f\u043e\u0434\u0433\u0440\u0443\u043f\u043f\u044b \u043f\u0443\u0441\u0442 "),e.qZA(),e.TgZ(24,"ol",12),e.YNc(25,ye,2,1,"li",13),e.qZA()()()()}if(2&n){const o=e.oxw();e.xp6(7),e.hij(" \u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u043e\u0434\u0433\u0440\u0443\u043f\u043f\u044b: ",o.subgroup.name," "),e.xp6(2),e.hij(" \u0421\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044c: ",e.lcZ(10,5,o.subgroup.creator)," "),e.xp6(3),e.hij(" \u0427\u0438\u0441\u043b\u043e \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432: ",null==o.subgroup.users?null:o.subgroup.users.length," "),e.xp6(10),e.Q6J("hidden",0!==(null==o.subgroup.users?null:o.subgroup.users.length)),e.xp6(3),e.Q6J("ngForOf",o.subgroup.users)}}function Se(n,t){if(1&n&&e._UZ(0,"app-list-bookings",18),2&n){const o=e.oxw();e.Q6J("subgroup",o.subgroup)}}k.\u0275fac=function(t){return new(t||k)(e.Y36(e.SBq),e.Y36(e.Qsj),e.Y36(J.e))},k.\u0275dir=e.lG2({type:k,selectors:[["","hideForbbidenElements",""]]});class A{constructor(t,o,s){this.activatedRoute=t,this.subgroupService=o,this.modalService=s,this.onDestroy$=new d.x}editSubgroup(){const t=this.modalService.open(D,{size:"lg"});t.componentInstance.subgroup=this.subgroup,t.closed.pipe((0,p.R)(this.onDestroy$)).subscribe(()=>this.getSubgroup())}addUsersByGroupName(){const t=this.modalService.open(F,{size:"xl"});t.componentInstance.subgroup=this.subgroup,t.hidden.pipe((0,p.R)(this.onDestroy$)).subscribe(()=>this.getSubgroup())}ngOnDestroy(){this.onDestroy$.next(!0),this.onDestroy$.complete()}ngOnInit(){this.activatedRoute.data.subscribe(({subgroup:t})=>{this.subgroup=t})}getSubgroup(){this.subgroupService.getSubgroupById(this.subgroup.id).pipe((0,p.R)(this.onDestroy$)).subscribe(t=>this.subgroup=t)}}A.\u0275fac=function(t){return new(t||A)(e.Y36(U.gz),e.Y36(B.H),e.Y36(a.FF))},A.\u0275cmp=e.Xpm({type:A,selectors:[["app-subgroup"]],decls:4,vars:2,consts:[["hideForbbidenElements","",1,"container"],["class","col",4,"ngIf"],[1,"row"],["class","col",3,"subgroup",4,"ngIf"],[1,"col"],[1,"col-12","text-center"],[1,"row","pt-3"],[1,"col-6"],[1,"manage-buttons"],["data-access-only","teacher",1,"btn","btn-secondary",3,"click"],[1,"col-6","users-block"],[1,"alert","alert-info",3,"hidden"],[1,"col-12","pl-3","pr-3","list-group","list-group-numbered","overflow-auto","h-100"],["class","list-group-item d-flex justify-content-between align-items-start",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","justify-content-between","align-items-start"],["class","ms-2 me-auto",4,"ngIf"],[1,"ms-2","me-auto"],[1,"fw-bold"],[1,"col",3,"subgroup"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,xe,26,7,"div",1),e.TgZ(2,"div",2),e.YNc(3,Se,1,1,"app-list-bookings",3),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("ngIf",o.subgroup),e.xp6(2),e.Q6J("ngIf",o.subgroup))},dependencies:[l.sg,l.O5,T,k,w.o],styles:[".users-block[_ngcontent-%COMP%]{height:300px}.manage-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}"]});var Ce=u(8505),Ze=u(2977);class _{constructor(t,o,s,i){this.subgroupService=t,this.modalService=o,this.router=s,this.authService=i}resolve(t,o){const s=t.paramMap.get("id");return null===s&&this.router.navigate(["subgroups"]),this.getSubgroup(+s)}checkAccessToPage(t){this.checkUserInGroup(t)||this.authService.currentUser?.role===Ze.y.teacher||this.router.navigate(["subgroups"])}checkUserInGroup(t){return!!t.users?.find(s=>this.authService.currentUser?.id===s.id)}getSubgroup(t){return this.subgroupService.getSubgroupById(t).pipe((0,E.q)(1),(0,Ce.b)(this.checkAccessToPage.bind(this)),(0,Y.K)(this.someError.bind(this)))}someError(t){console.error(t);let o="\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a";throw 404==t.status&&(o="\u041f\u043e\u0433\u0440\u0443\u043f\u043f\u0430 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430"),new m.p(this.modalService).addHeader("\u041e\u0448\u0438\u0431\u043a\u0430").addText(o).setDangerStyle().openAlertModal().result.finally(()=>this.router.navigate(["subgroups"])),t}}_.\u0275fac=function(t){return new(t||_)(e.LFG(B.H),e.LFG(a.FF),e.LFG(U.F0),e.LFG(J.e))},_.\u0275prov=e.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"});const Te=[{path:":id",component:A,resolve:{subgroup:_}}];class f{}f.\u0275fac=function(t){return new(t||f)},f.\u0275mod=e.oAB({type:f}),f.\u0275inj=e.cJS({imports:[O.ManagingSubgroupsModule,r.u5,r.UX,l.ez,a.bz,V.N,a.M,a.UL,U.Bz.forChild(Te)]})}}]);